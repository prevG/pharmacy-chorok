<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="layouts/admin_layout">

<!-- index.html 고유 CSS 추가 -->
<th:block layout:fragment="css">
</th:block>

<!-- index.html 고유 스크립트 추가 -->
<th:block layout:fragment="script">
	<script>
	
    function onLoadSuccess(data){  
      $('#dg').datagrid('enableDnd');
    }   

	function fnSearch(){
		$.ajax({
	      type: "POST",
	      url: '/admin/getCodesByGrpCd',
	      dataType: 'json',
	      //data:$('#searchUser').serialize(),    
	    }).done(function( responseJson ) {
	    	console.log(responseJson);
          	$('#dg').datagrid('loadData', responseJson ); 
          	
        });
	}
	
	
	$(document).ready(function(){
		fnSearch();
	});

	
	function addCode(){
		 $('#dlg').dialog('open').dialog('center').dialog('setTitle','코드추가');
         $('#fm').form('clear');
         url = '/admin/addCode';
	}
	
	function removeCode(){
		var row = $("#dg").datagrid("getSelected");
		
		if(row){
			$.messager.confirm('Confirm','코드를 삭제하겠습니까?',function(r){
                    if (r){
                        $.post('/admin/removeCode',{id:row.id},function(result){
                            if (result.success){
                                $('#dg').datagrid('reload');    // reload the user data
                            } else {
                                $.messager.show({    // show error message
                                    title: 'Error',
                                    msg: result.errorMsg
                                });
                            }
                        },'json');
                    }
           });
		}
	}

	function editCode(){
		 var row = $('#dg').datagrid('getSelected');
         if (row){
             $('#dlg').dialog('open').dialog('center').dialog('setTitle','코드수정');
             $('#fm').form('load',row);
             //url = 'update_user.php?id='+row.id;
         }
	}
	
	function saveCode(){
		 $('#fm').form('submit',{
              url: url,
              iframe: false,
              onSubmit: function(){
                  return $(this).form('validate');
              },
              success: function(result){
                  var result = eval('('+result+')');
                  if (result.errorMsg){
                      $.messager.show({
                          title: 'Error',
                          msg: result.errorMsg
                      });
                  } else {
                      $('#dlg').dialog('close');        // close the dialog
                      $('#dg').datagrid('reload');    // reload the user data
                  }
              }
          });
	}
</script>
</th:block>

<div id="content-wrapper" class="d-flex flex-column" layout:fragment="content">

	<nav aria-label="breadcrumb">
		<ol class="breadcrumb">
			<li class="breadcrumb-item"><a href="#">Home</a></li>
			<li class="breadcrumb-item"><a href="#">공통코드 관리</a></li>
			<li class="breadcrumb-item active" aria-current="page">공통코드 관리</li>
		</ol>
	</nav>

	<!-- Main Content -->
	<div id="content">
		<!-- Begin Page Content -->
		<div class="container-fluid">

			<!-- Top Content -->
			<div class="card shadow mb-1">
				<div class="card-header">
					<h5 class="m-0 font-weight-bold text-primary">검색</h5>
				</div>
				<div class="card-body">
					<form class="form-inline">
						<div class="form-group">
							<span class="align-middle font-weight-bold" style="width: 80px;">검색어</span>

							<select class="form-control-sm custom-select-sm custom-select ml-3" id="codeSel">
								<option selected>선택...</option>
								<option value="#">코드명</option>
								<option value="#">코드</option>
							</select>
							<input type="search" class="form-control form-control-sm ml-3" placeholder="" aria-controls="dataTable">
						</div>
					</form>
					<hr class="mt-2 mb-2" />
					<form class="form-inline">
						<div class="form-group">
							<span class="align-middle font-weight-bold" style="width: 80px;">그룹코드</span>

							<select class="form-control-sm custom-select-sm custom-select ml-3" id="grpCodeSel">
								<option selected>선택...</option>
								<option value="#">사용자그룹</option>
								<option value="#">전화번호그룹</option>
							</select>
						</div>
					</form>
					<hr class="mt-2 mb-2" />
					<form class="form-inline">
						<div class="form-group">
							<span class="align-middle font-weight-bold" style="width: 80px;">사용여부</span>
							<div class="form-check ml-3">
								<input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1"> <label class="form-check-label" for="flexRadioDefault1"> 전체 </label>
							</div>
							<div class="form-check ml-3">
								<input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault2" checked> <label class="form-check-label" for="flexRadioDefault2"> 사용 </label>
							</div>
							<div class="form-check ml-3">
								<input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault3" checked> <label class="form-check-label" for="flexRadioDefault3"> 미사용 </label>
							</div>
						</div>
					</form>
					<hr class="mt-3 mb-3" />
					<!-- <button type="button" class="btn-sm btn-primary mr-1 float-right px-4" id="srchBtn">조회</button>
					<button type="button" class="btn-sm btn-secondary mr-1 float-right px-4" id="regBtn">등록</button> -->


					<a href="#" class="easyui-linkbutton float-right mx-2" data-options="iconCls:'icon-search'" style="width: 80px" onClick="fnSearch();">검색</a>

				</div>
			</div>




			<!-- DataTales -->
			<div class="card shadow">
				<div class="card-header">
					<h5 class="m-0 font-weight-bold text-primary">조회내역</h5>
				</div>

				<div class="card-body" style="min-height: 530px;">

					<div style="padding: 5px 0;">
						<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-add'" onClick="addCode();">추가</a> 
						<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-remove'" onClick="removeCode();">삭제</a> 
						<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-edit'" onclick="editCode();">편집</a> 
						<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-save'" onClick="saveCode();">저장</a>
						<!-- 	        <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-cut',disabled:true">Cut</a>
				        <a href="javascript:void(0)" class="easyui-linkbutton">Text Button</a> -->
					</div>
					<!--  <p>Fixed Width Buttons</p>
				    <div style="padding:5px 0;">
				        <a href="#" class="easyui-linkbutton" data-options="iconCls:'icon-search'" style="width:80px">Search</a>
				        <a href="#" class="easyui-linkbutton" data-options="iconCls:'icon-print'" style="width:80px">Print</a>
				        <a href="#" class="easyui-linkbutton" data-options="iconCls:'icon-reload'" style="width:80px">Reload</a>
				        <a href="#" class="easyui-linkbutton" data-options="iconCls:'icon-help'" style="width:80px">Help</a>
				    </div> -->
				<!-- 	<table class="easyui-datagrid" style="width: 100%; height: 400px" id="dg" toolbar="#toolbar" pagination="true" rownumbers="true" fitColumns="true" singleSelect="true">
						<thead>
							<tr>
								<th data-options="field:'code',width:100">NO</th>
								<th data-options="field:'ditcNm',width:300">코드명</th>
								<th data-options="field:'ditcCd',width:150">코드</th>
								<th data-options="field:'grpCd',width:150">상위코드</th>
								<th data-options="field:'price',width:300">상위코드명</th>
								<th data-options="field:'vorder',width:150">정렬순서</th>
								<th data-options="field:'useYn',width:100">사용여부</th>
							</tr>
						</thead>
					</table> -->
					
					 <table id="dg" class="easyui-datagrid" title="DataGrid" style="width:100%;height:600px" data-options="
				          singleSelect:false, 
				          ctrlSelect:true,
				          idField:'id',
				          pagination:true,pageSize:50,pageList:[50],
				          dragSelection: true,
				          onLoadSuccess: onLoadSuccess">
				      <thead>
				        <tr>
				          <th data-options="field:'grpCd',width:170,align:'center'">그룹코드</th>
				          <th data-options="field:'ditcCd',width:170,align:'center'">상세코드</th>
				          <th data-options="field:'ditcNm',width:350,align:'center'">상세코드이름</th>
				          <th data-options="field:'cdExp',width:350,align:'center'">코드설명</th>
				          <th data-options="field:'vOrder',width:100,align:'center'">순서</th>
				          <th data-options="field:'lockYn',width:150,align:'center'">잠금여부</th>
				          <th data-options="field:'useYn',width:150,align:'center'">사용여부</th>
				        </tr>
				      </thead>
				    </table>


<!-- 
					<button type="button" class="btn-sm btn-success mr-1 float-right px-4" id="modBtn">위로이동</button>
					<button type="button" class="btn-sm btn-success mr-1 float-right px-4" id="modBtn">아래로이동</button>
					<button type="button" class="btn-sm btn-secondary mr-1 float-right px-4" id="modBtn">수정</button> -->
				</div>
			</div>
		</div>
		<!-- /.container-fluid -->
	</div>
	<!-- End of Main Content -->

	<div id="dlg" class="easyui-dialog" style="width:700px" data-options="closed:true,modal:true,border:'thin',buttons:'#dlg-buttons'">
		<form id="fm" method="post" novalidate style="margin: 0; padding: 20px 50px">
			<div style="margin-bottom: 10px">
				<input name="grpCd" class="easyui-textbox" required="true" label="그룹코드:" style="width: 100%">
			</div>
			<div style="margin-bottom: 10px">
				<input name="ditcCd" class="easyui-textbox" required="true" label="코드:" style="width: 100%">
			</div>
			<div style="margin-bottom: 10px">
				<input name="ditcNm" class="easyui-textbox" required="true" label="코드이름:" style="width: 100%">
			</div>
			<div style="margin-bottom: 10px">
				<input name="cdExp" class="easyui-textbox" required="true" validType="email" label="코드설명:" style="width: 100%">
			</div>
			<div style="margin-bottom: 10px">
				<input name="vOrder" class="easyui-textbox" required="true" label="순서:" style="width:150px;">
			</div>
			<div style="margin-bottom: 10px">
				<select id="lockYn" class="easyui-combobox" required="true" name="lockYn" style="width:200px;" label="잠금여부:">
					<option selected="selected">선택</option>
				    <option value="Y">잠금</option>
				    <option value="N">비잠금</option>
				</select>
			</div>
			<div style="margin-bottom: 10px">
				<select id="useYn" class="easyui-combobox" required="true" name="useYn" style="width:200px;" label="사용여부">
					<option selected="selected">선택</option>
				    <option value="Y">사용</option>
				    <option value="N">비사용</option>
				</select>
			</div>
		</form>
		<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-save'" onClick="saveCode();">저장</a>
	</div>

	<!-- Footer -->
	<footer th:replace="fragments/admin_footer :: footerFragment"></footer>
	<!-- End of Footer -->

</div>
<!-- End of Content Wrapper -->

</div>
<!-- End of Page Wrapper -->


<!-- Scroll to Top Button-->
<a class="scroll-to-top rounded" href="#page-top"> <i class="fas fa-angle-up"></i></a>

</html>