<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="layouts/admin_layout">

<!-- index.html 고유 CSS 추가 -->
<th:block layout:fragment="css">
</th:block>

<!-- index.html 고유 스크립트 추가 -->
<th:block layout:fragment="script">
	<script>
		
		function fnSearch(){
			var queryParams=$("#dg").datagrid('options').queryParams;
			queryParams.cbSrch= $('#cb_srch').combobox('getValue');
			queryParams.cbAuth= $('#cb_usrAuth').combobox('getValue');
			queryParams.cbAppv= $('#cb_usrAprv').combobox('getValue');
			queryParams.target= "grid";
			queryParams.srchTxt= $("#srchTxt").val();
			$('#dg').datagrid('reload');
		}
		
		
		function fnInit(){
			
			initComboBox($('#cb_usrAuth'), '/admin/getGrpCd', {GrpCd:'C1002',target:'combo', targetKind:'0'});
			initComboBox($('#cb_usrAprv'), '/admin/getGrpCd', {GrpCd:'C1010',target:'combo', targetKind:'0'});
			
			$('#dg').datagrid({
			    url: '/admin/getAdmin',
			    saveUrl: '/admin/saveAdmin',
			    updateUrl: '/admin/modifyAdmin',
			    destroyUrl: '/admin/removeAdmin',
			    onEndEdit:function(index,row){
		            var ed = $(this).datagrid('getEditor', {
		                index: index,
		                field: 'productid'
		            });
		            row.productname = $(ed.target).combobox('getText');
		        },
		        onBeforeEdit:function(index,row){
		            row.editing = true;
		            $(this).datagrid('refreshRow', index);
		        },
		        onAfterEdit:function(index,row){
		            row.editing = false;
		            $(this).datagrid('refreshRow', index);
		        },
		        onCancelEdit:function(index,row){
		            row.editing = false;
		            $(this).datagrid('refreshRow', index);
		        }
			});
		}
		
		
		function getRowIndex(target){
		    var tr = $(target).closest('tr.datagrid-row');
		    return parseInt(tr.attr('datagrid-row-index'));
		}
		function editrow(target){
		    $('#dg').datagrid('beginEdit', getRowIndex(target));
		}
		function deleterow(target){
		    $.messager.confirm('Confirm','Are you sure?',function(r){
		        if (r){
		            $('#dg').datagrid('deleteRow', getRowIndex(target));
		        }
		    });
		}
		function saverow(target){
		    $('#dg').datagrid('endEdit', getRowIndex(target));
		}
		function cancelrow(target){
		    $('#dg').datagrid('cancelEdit', getRowIndex(target));
		}
		
		
		function removeAdmin(){
			var row = $("#dg").datagrid("getSelected");
			//console.log(row);
			if(row){
				$.messager.confirm('Confirm','사용자를 삭제하겠습니까?',function(r){
	                 if (r){
	                     $.post('/admin/removeAdmin',{usrNo:row.usrNo},function(result){
	                         if (result.success){
	                             //$('#dg').datagrid('reload');    // reload the user data
	                             
	                              $.messager.show({    // show error message
	                                 title: 'Success',
	                                 msg: result.Msg
	                             });
	                             fnSearch();
	                         } else {
	                             $.messager.show({    // show error message
	                                 title: 'Error',
	                                 msg: result.Msg
	                             });
	                         }
	                     },'json');
	                 }
	           });
			}
			
		}
		
		function addAdmin(){
			 $('#addDlg').dialog('open').dialog('center').dialog('setTitle','관리자 추가');
	         $('#addFrm').form('clear');
	         
	         initComboBox($('#dlg_usrGrade'), '/admin/getGrpCd', {GrpCd:'C1003',target:'combo', targetKind:'1'});
	         initComboBox($('#dlg_usrAuth'), '/admin/getGrpCd', {GrpCd:'C1002',target:'combo', targetKind:'1'});
	         initComboBox($('#dlg_usrAprv'), '/admin/getGrpCd', {GrpCd:'C1010',target:'combo', targetKind:'1'});
	         initComboBox($('#dlg_delYn'), '/admin/getGrpCd', {GrpCd:'C1012',target:'combo', targetKind:'1'});
		}
		
		
		function saveDlgAdmin(){
			var param = {
				usrEml : $('#dlg_em').textbox('getValue'),
				usrPwd : $('#dlg_pw').textbox('getValue'),
				usrNm : $('#dlg_usrNm').textbox('getValue'),
				usrPhnNo : $('#dlg_usrPhnNo').textbox('getValue'),
				usrGrade : $('#dlg_usrGrade').combobox('getValue'),
				usrAuth : $('#dlg_usrAuth').combobox('getValue'),
				usrAprv : $('#dlg_usrAprv').combobox('getValue'),
				delYn : $('#dlg_delYn').textbox('getValue')
			};
			
			
			$.post('/admin/saveAdmin',param,function(result){
                  if (result.success){
                      
                       $.messager.show({    // show error message
                          title: 'Success',
                          msg: result.Msg
                      });
                      
                      fnSearch();
                  } else {
                      $.messager.show({    // show error message
                          title: 'Error',
                          msg: result.Msg
                      });
                  }
                  
                  $('#addDlg').dialog('close');
              },'json')
			
			
		}
		
		$(document).ready(function(){
			fnInit();
		});
		
		
		function formatDate(value, row){
			return "kkj"+value;
		}
		
	
		
		function editAdmin(){
			$('#dg').datagrid('beginEdit', 1);
		}
	
	</script>
</th:block>

<div id="content-wrapper" class="d-flex flex-column" layout:fragment="content">

	<nav aria-label="breadcrumb">
		<ol class="breadcrumb">
			<li class="breadcrumb-item"><a href="#">Home</a></li>
			<li class="breadcrumb-item"><a href="#">사용자 관리</a></li>
			<li class="breadcrumb-item active" aria-current="page">관리자 관리</li>
		</ol>
	</nav>

	<!-- Main Content -->
	<div id="content">
		<!-- Begin Page Content -->
		<div class="container-fluid">
			<div class="card shadow mb-1">
				<div class="card-header">
					<h5 class="m-0 font-weight-bold text-primary">검색</h5>
				</div>
				<div class="card-body">
					<form class="form-inline">
						<div class="form-group">
							<select id="cb_srch" class="easyui-combobox" required="true" name="cb_srch" style="width:200px;" label="검색어">
								<option value="all" selected="selected">선택</option>
							    <option value="nm">이름</option>
							    <option value="em">이메일</option>
							</select>
							&nbsp;
							<input class="easyui-textbox" data-options="iconCls:'icon-search'" style="width:300px" id="srchTxt">
							&nbsp;
							<a href="#" class="easyui-linkbutton float-right mx-2" data-options="iconCls:'icon-search'" style="width: 80px" onClick="fnSearch();">검색</a>
						</div>
					</form>
					<hr class="mt-2 mb-2" />
					<form class="form-inline">
						<div class="form-group">
							<select id="cb_usrAuth" class="easyui-combobox"  name="cb_usrAuth" style="width:300px;" label="권한">
							</select>
						</div>
					</form>
					<hr class="mt-2 mb-2" />
					<form class="form-inline">
						<div class="form-group">
							<select id="cb_usrAprv" class="easyui-combobox" name="cb_usrAprv" style="width:300px;" label="승인여부">
							</select>
						</div>
					</form>
				</div>
			</div>
			<!-- 
			<a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="javascript:$('#dg').edatagrid('addRow')">New</a>
		<a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-remove" plain="true" onclick="javascript:$('#dg').edatagrid('destroyRow')">Destroy</a>
		<a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-save" plain="true" onclick="javascript:$('#dg').edatagrid('saveRow')">Save</a>
		<a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-undo" plain="true" onclick="javascript:$('#dg').edatagrid('cancelRow')">Cancel</a> -->
			
			<div class="card shadow mb-4">
				<div class="card-header">
					<h5 class="m-0 font-weight-bold text-primary">조회내역</h5>
				</div>
				<div class="card-body" style="min-height: 530px;">

					<div style="padding: 5px 0;">
						<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-add'" onClick="addAdmin();">추가</a> 
						<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-remove'" onClick="removeAdmin();">삭제</a> 
						<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-edit'" onclick="editAdmin();">편집</a> 
						<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-save'" onClick="saveAdmin();">저장</a>
					</div>
					
					<table id="dg" class="easyui-datagrid" title="관리자검색결과" style="width:100%;height:600px" 
					data-options="singleSelect:true, 
						          ctrlSelect:true,
						          idField:'usrNo',
						          rownumbers:true,
						          fitColumns:true, 
						          fit:true,
						          emptyMsg:'검색 조건에 해당하는 자료가 없습니다.',
						          pagination:true,pageSize:50,pageList:[50],
						          dragSelection: true">
				       <thead>
					        <tr>
					          <th field='usrNo' width='0' align='center' hidden='true'>사용자번호</th>
					          <th field='usrNm' width='150' align='center' editor='text'>사용자이름</th>
					          <th field='usrEml' width='250' align='center' editor='{type:"validatebox",options:{required:true,validType:"email"}}'>이메일</th>
					          <th field='usrPhnNo' width='200' align='center' editor='text'>핸드폰번호</th>
					          <th field='usrGrade' width='100' align='center' editor='text'>직위</th>
					          <th field='usrAuth' width='100' align='center' editor='text'>권한</th>
					          <th field='usrAprv' width='100' align='center' editor='text'>승인여부</th>
					          <th field='delYn' width='150' align='center' editor='{type:"checkbox",options:{on:"Y",off:"N"}}'>삭제여부</th>
					          <th field='regDt' width='200' align='center' editor='text' formatter="formatDate">등록날짜</th>
					        </tr>
				      </thead>
				    </table>
				    
				    
				</div>
			</div>

		</div>
		<!-- /.container-fluid -->
	</div>
	<!-- End of Main Content -->
	
	<div id="addDlg" class="easyui-dialog" style="width:700px" data-options="closed:true,modal:true,border:'thin',buttons:'#dlg-buttons'">
		<form id="addFrm" method="post" novalidate style="margin: 0; padding: 20px 50px">
			<div style="margin-bottom: 10px" class="row">
				<div class="col">
					<input name="dlg_em" id="dlg_em" class="easyui-textbox" required="true" validType="email" label="이메일:" style="width: 100%">
				</div>
				<div class="col">
				  	<input name="dlg_pw" id="dlg_pw" class="easyui-passwordbox" prompt="Password" iconWidth="28" label="패스워드:" style="width:100%;height:30px;">
				</div>
			</div>
			<div style="margin-bottom: 10px" class="row">
				<div class="col">
					<input name="dlg_usrNm" id="dlg_usrNm" class="easyui-textbox" required="true" validType="email" label="사용자이름:" style="width: 100%">
				</div>
				<div class="col">
				  	<input name="dlg_usrPhnNo" id="dlg_usrPhnNo" class="easyui-textbox" required="true" validType="email" label="핸드폰번호:" style="width: 100%">
				</div>
			</div>
			<div style="margin-bottom: 10px" class="row">
				<div class="col">
					<select id="dlg_usrGrade" name="dlg_usrGrade" class="easyui-combobox" required="true" style="width:100%;" label="직위">
					</select>
				</div>
				<div class="col">
					<select id="dlg_usrAuth" name="dlg_usrAuth" class="easyui-combobox" required="true" style="width:100%;" label="권한">
					</select>
				</div>
			</div>
			<div style="margin-bottom: 10px" class="row">
				<div class="col-6">
					<select id="dlg_usrAprv" name="dlg_usrAprv" class="easyui-combobox" required="true" style="width:100%;" label="승인여부">
					</select>
				</div>
				<div class="col-6">
					<select id="dlg_delYn" name="dlg_delYn" class="easyui-combobox" required="true" style="width:200px;" label="삭제여부">
						<option value="N" selected="selected">비삭제</option>
					    <option value="Y">삭제</option>
					</select>
				</div>
			</div>
		</form>
		<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-save'" onClick="saveDlgAdmin();">저장</a>
	</div>
	
	
	<footer th:replace="fragments/admin_footer :: footerFragment"></footer>
</div>


</html>