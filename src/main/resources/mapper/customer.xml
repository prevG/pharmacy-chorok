<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.pharm.chorok.web.main.repository.CustomerRepository">

	<select id="selectNewCustId" resultType="long">
	<![CDATA[    
    SELECT CASE WHEN MAX( CUST_ID ) IS NULL THEN 1
                ELSE MAX( CUST_ID ) + 1 
	       END AS "newId"
      FROM TB_CUSTOMER
	]]>
	</select>

    <select id="selectCustomerByUsrNmOrCellNo" parameterType="map" resultType="com.pharm.chorok.domain.table.TbCustomer">
	<![CDATA[ 
	/** com.pharm.chorok.web.main.repository.repository.CustomerRepository */
    SELECT *
      FROM TB_CUSTOMER
     WHERE 1 = 1
    ]]>
    <if test="custUsrNm != null and custUsrNm != ''">
       AND CUST_USR_NM LIKE CONCAT('%', #{custUsrNm}, '%')
    </if>
    <if test="custCellNo != null and custCellNo != ''">
       AND CUST_CELL_NO LIKE CONCAT('%', #{custCellNo}, '%')
    </if>
    <![CDATA[ 
     ORDER
        BY CUST_USR_NM
	]]>
	</select>


	<select id="findCustomerByCustId" parameterType="map" resultType="com.pharm.chorok.domain.table.TbCustomer">
	<![CDATA[    
    SELECT CUST_ID
         , CUST_USR_NM
         , CUST_CELL_NO
         , CUST_BIRTH_DT
         , CUST_GEN_TP_CD
         , MRG_YN
         , PCRT_CHD_CNT
         , LST_PCRT_YEAR
         , BRST_FDG_YN
         , VIST_TP_CD
         , ZIP_CODE
         , ADDR1
         , ADDR2
         , REG_DT
         , REG_USR_NO
         , UPD_DT
         , UPD_USR_NO
      FROM TB_CUSTOMER
     WHERE CUST_ID = #{custId}
	]]>
	</select>

    <select id="findCustomerByRsvtId" parameterType="map" resultType="com.pharm.chorok.domain.table.TbCustomer">
	<![CDATA[    
    SELECT CUST.CUST_ID
         , CUST.CUST_USR_NM
         , CUST.CUST_CELL_NO
         , CUST.CUST_BIRTH_DT
         , CUST.CUST_GEN_TP_CD
         , CUST.MRG_YN
         , CUST.PCRT_CHD_CNT
         , CUST.LST_PCRT_YEAR
         , CUST.BRST_FDG_YN
         , CUST.VIST_TP_CD
         , CUST.ZIP_CODE
         , CUST.ADDR1
         , CUST.ADDR2
         , CUST.REG_DT
         , CUST.REG_USR_NO
         , CUST.UPD_DT
         , CUST.UPD_USR_NO
      FROM TB_CUSTOMER CUST
      LEFT OUTER JOIN
           TB_PP_RSVT_SCH RSVT
        ON CUST.CUST_ID = RSVT.CUST_ID
     WHERE RSVT_ID = #{rsvtId}
	]]>
	</select>

    <select id="findAllCustomer" parameterType="com.pharm.chorok.domain.table.TbCustomer" resultType="com.pharm.chorok.domain.table.TbCustomer">
	<![CDATA[    
    SELECT CUST_ID
         , CUST_USR_NM
         , CUST_CELL_NO
         , CUST_BIRTH_DT
         , CUST_GEN_TP_CD
         , MRG_YN
         , PCRT_CHD_CNT
         , LST_PCRT_YEAR
         , BRST_FDG_YN
         , VIST_TP_CD
         , ZIP_CODE
         , ADDR1
         , ADDR2
         , REG_DT
         , REG_USR_NO
         , UPD_DT
         , UPD_USR_NO
      FROM TB_CUSTOMER A
     WHERE 1 = 1
    ]]>
    <if test="custUsrNm !=null and !''.equals(custUsrNm)">
       AND CUST_USR_NM LIKE CONCAT('%', #{custUsrNm}, '%')
    </if>
    <if test="custCellNo !=null and !''.equals(custCellNo)">
       AND CUST_CELL_NO LIKE CONCAT('%', #{custCellNo}, '%')
    </if>
	<![CDATA[    
     ORDER
        BY CUST_USR_NM
	]]>
	</select>

    <insert id="insertTbCustomer" parameterType="com.pharm.chorok.domain.table.TbCustomer">
	<![CDATA[    
    INSERT INTO TB_CUSTOMER (
           CUST_ID
         , CUST_USR_NM
         , CUST_CELL_NO
         , CUST_BIRTH_DT
         , CUST_GEN_TP_CD
         , MRG_YN
         , PCRT_CHD_CNT
         , LST_PCRT_YEAR
         , BRST_FDG_YN
         , VIST_TP_CD
         , ZIP_CODE
         , ADDR1
         , ADDR2
         , REG_DT
         , REG_USR_NO
    ) VALUES (
           #{custId}
         , #{custUsrNm}
         , #{custCellNo}
         , #{custBirthDt}
         , #{custGenTpCd}
         , #{mrgYn}
         , #{pcrtChdCnt}
         , #{lstPcrtYear}
         , #{brstFdgYn}
         , #{vistTpCd}
         , #{zipCode}
         , #{addr1}
         , #{addr2}
         , now()
         , #{regUsrNo}
    )
	]]>
	</insert>

    <update id="updateTbCustomer" parameterType="com.pharm.chorok.domain.table.TbCustomer">
	<![CDATA[    
    UPDATE TB_CUSTOMER
       SET UPD_DT          = now()
         , UPD_USR_NO      = #{regUsrNo}
         , CUST_USR_NM     = #{custUsrNm}
         , CUST_CELL_NO    = #{custCellNo}
         , CUST_BIRTH_DT   = #{custBirthDt}
         , CUST_GEN_TP_CD  = #{custGenTpCd}
         , MRG_YN          = #{mrgYn}
         , PCRT_CHD_CNT    = #{pcrtChdCnt}
         , LST_PCRT_YEAR   = #{lstPcrtYear}
         , BRST_FDG_YN     = #{brstFdgYn}
         , VIST_TP_CD      = #{vistTpCd}
         , ZIP_CODE        = #{zipCode}
         , ADDR1           = #{addr1}
         , ADDR2           = #{addr2}
     WHERE CUST_ID = #{custId}
	]]>
	</update>
</mapper>